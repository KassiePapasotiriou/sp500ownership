# Results

The main focus of our analysis will examine Robintrack's users stock holding of the S&P500 companies between August 2018 - August 2020. We will explore how price, market cap, industry and founding year affect user's holding.

## Average Ownership by industry

```{r,message= FALSE}
addUnits <- function(n) {
  labels <- ifelse(n < 1000, n,  # less than thousands
  ifelse(n < 1e6, paste0(round(n/1e3), 'k'),  # in thousands
  ifelse(n < 1e9, paste0(round(n/1e6), 'M'),  # in millions
 ifelse(n < 1e12, paste0(round(n/1e9), 'B'), # in billions
  ifelse(n < 1e15, paste0(round(n/1e12), 'T'), 'too big!')))))
  return(labels)
}

```

```{r}
library(GGally)
library(ggplot2)
library(palmerpenguins)

cleveland <-read.csv('docs/data/results/cleveland.csv')
```

The first transformed dataframe the average user's stock holding per industry for 2018, 2019 and 2020. 

In order explore the shifts in the most popular industries between 2018-2020, we have created a Clevland plot for which we have sorted the y axis in descending order for the users holding on 2020.

```{r qplot51, fig.width=10, fig.height=6,message=FALSE}
library(tidyverse)
library(scales)

cleveland$Year<-as.factor(cleveland[,'Year'])
# create the plot
ggplot(cleveland, aes(x = avg_users_holding, y =fct_reorder2(Symbol, Year == '2020', 
                                 avg_users_holding, .desc=FALSE),color = Year)) +
    geom_point() +
    scale_x_continuous(breaks = scales::pretty_breaks(n = 5),label=addUnits) + 
    xlab("\nAverage users holding") +
    ylab("Industry\n") +
    ggtitle("Average yearly Stock Holding by industry\nAugust 2018 - August 2020") + theme_gray(16)
```

Some insights that we can extract from the above plot are:

* We can see a jump in users holding for across all industries between 2018/2019 and 2020. A possible explanation is that retail trading has taken off in 2020 amid the coronavirus downturn that many young traders saw as an entry point into the world of investing.

* This jump is especially evident in the following industries;`Comunication Services`, `Consumer Discretionary`,`Industrials` and `Energy`.

* The largest jump in user's holding between 2019 and 2020 was in the `Consumer Discretionary` industry. A possible explanation could be the increased interest of the Amazon (AMZN) stock during the pandemic.

* Even though  `Information Technology` industry had the second highest average user's holding in 2018 and 2019, in 2020 it dropped to 4th place.

* Similarly in 2018 & 2019 `Energy` industry was less attractive than `Consumer Staples`. However, in 2020 `Energy` attracted more stock holders. ``

* Another evident trend is that `Utilities`, `Materials` and `Real Estate` has similar average user's holding between 2018 and 2019. On the other hand the rest of the industried have experienced and increase in user's holding between these two years.

* Moreover, `Consumer Staples` and  `Industrials` industries have almost the same stock holding between 2018 and 2019. That trend was broken in 2020 when `Industrials` almost tripled in user's holding compared to `Consumer Staples`.

## Ownership by Company

In this subsection, we dig deeper to see if there are any pattern at the individual company level.
```{r, message= FALSE}
library(forcats)
library(tidyverse)
library(tidyr)
library(ggplot2)

df= read.csv(file = 'docs/data/results/data.csv')
df2 <- na.omit(df)
df2_summary <- df2 %>% group_by(Symbol) %>% summarise(Avg_holding = mean(users_holding))
```

We created a Cleveland dot plot to show the average number of account owners across all the companies in the S&P500.  In order to clearly show all 500 companes within the S&P500, we plotted five Cleveland dot plots of 100 companies each in descending order by average account ownership over the time period with the same x-axis scale for ease of comparison.

We can quickly see from these 5 graphs that the majority of the stocks are "not popular" which means there are few accounts who own this stock. There are only a handful of stocks that have considerably higher number of accounts who own the stocks. Based on this observation, we divide the companies into three categories: very popular, normally popular, and not popular with details noted in the Data Transformation section. In the subsequent data exploration, we focus our attention on the "very popular" category given there are much greater investor attention on these companies.

```{r, message=FALSE}
library(tidyverse)
df2_very_pop <- df2 %>% filter(popularity == "very_popular")%>% group_by(Symbol) %>% summarise(Avg_holding = mean(users_holding))


df2_normal <- df2 %>% filter(popularity == "normal")%>% group_by(Symbol) %>% summarise(Avg_holding = mean(users_holding))

df2_not_pop <- df2 %>% filter(popularity == "not_popular")%>% group_by(Symbol) %>% summarise(Avg_holding = mean(users_holding))

```


We first take a look at companies within the most popular category.
```{r, message= FALSE}
very_pop <- pull(arrange(df2_very_pop, desc(Avg_holding)),Symbol)
as.character(very_pop)
```

The top five most popular (by average number of account owners) companies are F (Ford Motors Vehicle), GE (General Electric Company), AAPL (Apple), MSFT (Microsoft), and DIS (Disney).  Unsurprisingly these are well-established companies that most households know. This is consistent with intuition that the most investors using the Robinhood app are retail investors so would invest in stable, well-known companies.

```{r, message= FALSE}
norm_pop <- pull(arrange(df2_normal, desc(Avg_holding)),Symbol)
as.character(norm_pop)
```

In the second tier of "normal"(ly) popular companies are AMD (Advanced Micro Devices), FB (Facebook), BAC (Bank of America), AMZN (Amazon), TWTR (Twitter), NFLX (Netflix), AAL (American Airline), DAL (Delta Airline), DAL (Nvidia), SBUX (Starbucks), T (AT&T), Carnival, Boeing, Coca-Cola, Micron Technology, and Norwegian Cruise Line.  Well most of these companies are also well-established companies, these are additional intuition supporting relatively higher account ownership behind these stocks. Many of these companies were heavily impacted by the pandemic and received intense investor attention in the post-COVID financial market. Travel-related companies such as American Airline, Delta Airline, and Boeing as well as leisure-related companies including Carnival and Norwegian Cruise line had businesses that were negatively impacted by the restriction imposed during the pandemic.  This led to their stock prices to plummet considerably. Retail investors perhaps saw this as an opportunity to "buy the dip" and increase account ownership for these companies. Another trend we see is the prevalence of tech companies that are positively impacted by the work-from-home dynamic in the post-COVID world.  Companies such as Advanced Micro Devices and Nvidia produce computing chips and systems for mobile computing 

As we shall see later in our data exploration, Robinhood saw a significant increase in new accounts and investing activity post March 2020, further supporting the intuition that companies that were heavily impacted by the pandemic would see heightened attention.


## Ownership of the `very_popular` companies

To better understand the distribution shape of the individual account ownership, we first looked at the histogram of the top 5 companies' ownership distribution.

```{r fig.height= 8, fig.width= 10, message= FALSE}
library(scales)
group1 <- df2 %>% filter(Symbol %in% very_pop) 
group1$Symbol <- factor(group1$Symbol, levels = very_pop)

ggplot(group1, aes(x = users_holding)) + 
  geom_histogram(bins=50) + 
  facet_wrap(~Symbol) + 
  scale_x_continuous(label=addUnits) + 
  labs(title = "Account Ownership Distribution of Top 5 Most Popular Companies", x = "Number of Account Who Own the Stock") + theme_gray(16)
```

Looking at the individual account ownership of the top 5 most popular companies, we can see that they are all right skewed distribution. There is one peak with high frequency for <= 250k account owners. For companies like Disney, Ford, and General Electric there is a second peak near the highest number of accounts (750k-1mm) but that peak is much smaller the first at the lower end. This makes intuitive sense as the second peak of high number of accounts would result in an elevated average account ownership putting in on the most popular list. The more popular companies (such as F and GE) tend to have wider min-to-max ranges than the less popular ones.

Next, we use boxplots to show the distribution of account ownership of the individual stocks within the most popular category. The circle denotes the mean for comparison with the quartiles.

```{r, message = FALSE}

df2 %>% filter(Symbol %in% very_pop) %>%  
  ggplot(aes(x = reorder(Symbol, -users_holding, median), y = users_holding)) + 
  geom_boxplot() + 
  scale_y_continuous(label=addUnits) +
  xlab("Top 5 Most Popular Companies") + 
  ylab ("Number of Accounts Who Own the Stock") + 
  stat_summary(fun = mean, geom = "point", shape = 1, size = 3)

```

Looking at the boxplots, it is evident that there are considerably number of outliers across all 5 companies.  Almost all of the outliers are skewed toward the high end which would increase the average account ownership across the time period. With the exception of MSFT, the mean across the remaining 4 companies seems to be near or above the upper hinge. APPL stands out with a much smaller H-spread compared to the other companies suggesting that the number of accounts who owned Apple is concentrated around just below the 250k mark. Within the H-spread, the length to the lower hinge and upper hinge look to be relatively symmetric. 

As we tried to examine any patterns regarding outliers, we used time series line graphs to introduce time as another variable.

```{r qplot57, fig.width=20, fig.height=10,message=FALSE}
# Libraries
library(ggplot2)
library(dplyr)
library("tidyverse")
library("ggridges")
library(scales)
library(lubridate)
data <- read.csv('docs/data/results/data.csv')
very_popular_data <- subset(data, data$popularity == 'very_popular')

very_popular_data$Date <- as.Date(very_popular_data$Date)
# Plot
very_popular_data %>%
  ggplot( aes(x=Date, y=users_holding, group=Symbol, color=Symbol)) +
  geom_line() + 
  geom_vline(xintercept =ymd("2020-01-21"), color ="blue") +
  annotate("text", x =ymd("2020-01-21"), y =100000,label =" Fist COVID-19 case in the US\n 1/21/2020", color ="blue",hjust =0, size = 7) +
  scale_x_date(date_labels = "%b-%Y", breaks = "2 month") + 
  scale_y_continuous(label=addUnits) +
  ggtitle("How the Number of Account Owners Changed for the Most 5 Popular Companies\nAugust 2018 - August 2020") +
  ylab("Number of Account Who Own the Stock\n")+ 
  xlab("") +  
  scale_y_continuous(label=addUnits) +
  theme(plot.title=element_text(size=30),
          axis.text=element_text(size=19),
         axis.title=element_text(size=26),
         legend.title = element_text( size = 22),
        legend.text = element_text(size = 20))
```

By looking how the daily number of account owners for a particular stock changed over time, we can easily see a significant increase around the March-April 2020 timeframe. Visually we can see that all of the outliers at significantly large number of account owners are during the later end of the available dataset near summer 2020. This is consistent with what we observed in the boxplot and histogram where for the majority of time period (from Aug 2018 to March 2020), the daily number of account owners was relatively stable within a tight range. 

Next, we plot the stock prices of the top 5 most popular companies to see if there's any relationship between the stock price and number of account owners.

```{r qplot59,  fig.width=20, fig.height=10, message=FALSE}
very_popular_data %>%
  ggplot( aes(x=Date, y=Adj.Close, group=Symbol, color=Symbol)) +
  geom_line() +
  geom_vline(xintercept =ymd("2020-01-21"), color ="blue") +
  annotate("text", x =ymd("2020-01-21"), y =30.75,label =" Fist COVID-19 case in the US\n 1/21/2020", color ="blue",hjust =0, size = 7) +
  scale_x_date(date_labels = "%b-%Y", breaks = "2 month") +
  ggtitle("Daily stock price for the most popular S&P500 companies\nAugust 2018 - August 2020") +
  xlab("") +
  ylab("Adj. Close Price\n") +
  scale_y_continuous(label=addUnits) +
  theme(plot.title=element_text(size=30),
          axis.text=element_text(size=19),
         axis.title=element_text(size=26),
         legend.title = element_text( size = 22),
        legend.text = element_text(size = 20))
```

We also looked at the market capitalization of these 5 companies. The market capitalization measures the size of the company's outstanding equity value. It is calculated by stock price multiplied by the number of shares outstanding.

```{r qplot58, fig.width=20, fig.height=11,message=FALSE}
very_popular_data %>%
  ggplot( aes(x=Date, y=Mcap, group=Symbol, color=Symbol)) +
  geom_line() +
  geom_vline(xintercept =ymd("2020-01-21"), color ="blue") +
  annotate("text", x =ymd("2020-01-21"), y = 400000,label =" Fist COVID-19 case in the US\n 1/21/2020", color ="blue",hjust =0, size = 7) +
  scale_x_date(date_labels = "%b-%Y", breaks = "2 month") + 
  ggtitle("Daily Market Cap for the most popular S&P500 companies\nAugust 2018 - August 2020")  +
  xlab("") +
  ylab("Market Cap") +  
  scale_y_continuous(label=addUnits) +
  theme(plot.title=element_text(size=30),
          axis.text=element_text(size=19),
         axis.title=element_text(size=26),
         legend.title = element_text( size = 22),
        legend.text = element_text(size = 20))
```

Since stock price level is an input in the market capitalization, it is unsurprisingly that the daily market cap of the companies follow a similar shape to the stock price. In this graph, Apple has a higher market cap than Microsoft despite Microsoft having a higher stock price. This trend is not statistically meaningful because Microsoft simply has lower number of shares outstanding.

From the graphs, we can see that across all 5 companies, the stock price took a hit in March 2020 coinciding with the onset of the pandemic in the US. After the initial drop in price, the stock prices slowly increased back up. It is not consistent whether the stock prices increased back to the pre-pandemic level. One theory for this behavior is that investors using Robinhood took the opportunity to buy stocks when the price was low. Since these 5 companies are well established companies that are unlikely to be negatively impacted by the pandemic, investors increased their ownership of these stocks. They continued to buy these stocks as the stock prices continue to rise as a positive feedback loop to the positive returns on their investments.

Lastly, we looked at the VIX index which measure the market-implied pricing for markets volatility. It is an industry standard metric that indicates investor's expectation for uncertainty with a higher number corresponding to higher volatility. 

```{r qplot60, fig.width=10, fig.height=6, message=FALSE}
very_popular_data %>%
  ggplot( aes(x=Date, y=vix_Adj_close)) +
  geom_line() + 
  geom_vline(xintercept =ymd("2020-01-21"), color ="blue") +
  annotate("text", x =ymd("2020-01-21"), y =10,label =" Fist COVID-19 case in the US\n 1/21/2020", color ="blue",hjust =0, size = 4) +
  ggtitle("Daily VIX\nAugust 2018 - August 2020") +
  scale_x_date(date_labels = "%b-%Y", breaks = "2 month") + 
  ylab("VIX adjusted close\n") +
  xlab("") +  
  scale_y_continuous(label=addUnits) +
  theme( plot.title=element_text(size=14),
          axis.text=element_text(size=9),
         axis.title=element_text(size=14),
         legend.title = element_text( size = 6),
        legend.text = element_text(size = 5))
```


We see that the VIX spiked significantly during the March-April 2020 timeframe corresponding to when we saw a drop in stock price. Since the VIX is an indicator across the broader S&P500 index, it suggests that the outsized stock price movement was not limited to just the top 5 companies that we looked at. It further validates our original intuition that there is a trend of Robinhood investors taking advantage of the market uncertainty in March/April 2020 to buy certain well-established companies. By buying in well known companies with limited adverse impact from COVID-19, the investors can invest their money in a relatively safe stock that preserve capital and buy at a lower price with the hope that the stock returns back to previous levels. The continuation of higher account owners may be both attributed to higher overall accounts on Robinhood as well as positive feedback from subsequent stock performance.

## Ownership vs Founding Year 

As mentioned in the data transformation section, we measure a stock's popularity by averaging amount of user's holding acrross 2018-2020. We assign each company to a popularilty group by using KMeans clustering(k=3) for the avergage user's holding over those 3 years. The three popularity categories are; `not_popular`(n=473), `normal`(n=16) and `very_popular`(n=5).  

Moreover, as mentioned in the transformation section, we have also split the companies in three fouding dates ranges. We again used KMeans clustering(k=3) in order to group the S&P500 companies in three age groups for which we recorded the minimum and maximum founding rate in each group as their label. More specifically the three founding ranges are;`1784-1892`(n=247),`1894-1952`(n=400), `1954-2019`(n=798).

```{r qplot56, fig.width=6, fig.height=6,message=FALSE}
library(vcd)
mosaic <-read.csv('docs/data/results/mosaic.csv')
mosaic$Founded_range<-factor(mosaic$Founded_range, levels=c("1784-1892","1894-1952","1954-2019"))
mosaic$popularity<-factor(mosaic$popularity, levels=c("not_popular","normal","very_popular"))

colors = hue_pal()(3)
vcd::mosaic(Founded_range~popularity, direction = c("v","h") ,mosaic,
            highlighting_fill = colors, gp_varnames = gpar(fontsize = 10, fontface = 1),gp_labels = gpar(fontsize = 8))
```

In the above mosaic plot we can see that there is a correlation between the age of a company and its popularity. More specifically:

* We can see that for the less popular companies there is an equal amount of observations across all three founding ranges.

* When comparing the normal and the less popular companies we can see an increase in popularity as the founding date becomes more recent.

* Moreover, even though the oldest copanies are the ones that appear the least across the very popular companies, we can see that the medium founding range companies (`1894-1952`) are the the most across the `very_popular`.

* We would have been able to identify a positive correlation between how recently a company was founded and how popular the company is amongst Robinhood users. However this trend is broken in the `very_popular` companies.

A possible explanation of the partial positive correlation between founding year and popularity could due to the fact that Robinhood’s average customer is young^[According to [this](https://www.nytimes.com/2020/07/08/technology/robinhood-risky-trading.html) article] and therefore is more aware of the more recently founded companies.

