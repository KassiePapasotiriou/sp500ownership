<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data transformation | Exploration of the S&amp;P 500 stock ownership in Robinhood between Aug 2018 - Aug 2020</title>
  <meta name="description" content="Chapter 3 Data transformation | Exploration of the S&amp;P 500 stock ownership in Robinhood between Aug 2018 - Aug 2020" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data transformation | Exploration of the S&amp;P 500 stock ownership in Robinhood between Aug 2018 - Aug 2020" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data transformation | Exploration of the S&amp;P 500 stock ownership in Robinhood between Aug 2018 - Aug 2020" />
  
  
  

<meta name="author" content="Jingwen Du, Kassiani Papasotiriou" />


<meta name="date" content="2020-12-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources.html"/>
<link rel="next" href="missing-values.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"> S&P 500 stock ownership</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#raw-data"><i class="fa fa-check"></i><b>3.1</b> Raw data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-transformation.html"><a href="data-transformation.html#robintrack-data"><i class="fa fa-check"></i><b>3.1.1</b> Robintrack data</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-transformation.html"><a href="data-transformation.html#sp500-stock-prices-and-volume"><i class="fa fa-check"></i><b>3.1.2</b> S&amp;P500 stock prices and volume</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-transformation.html"><a href="data-transformation.html#vix-and-mcap"><i class="fa fa-check"></i><b>3.1.3</b> VIX and Mcap</a></li>
<li class="chapter" data-level="3.1.4" data-path="data-transformation.html"><a href="data-transformation.html#company-characteristics"><i class="fa fa-check"></i><b>3.1.4</b> Company characteristics</a></li>
<li class="chapter" data-level="3.1.5" data-path="data-transformation.html"><a href="data-transformation.html#combination-of-the-above"><i class="fa fa-check"></i><b>3.1.5</b> Combination of the above</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#further-preprocessing"><i class="fa fa-check"></i><b>3.2</b> Further preprocessing</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-transformation.html"><a href="data-transformation.html#clustering"><i class="fa fa-check"></i><b>3.2.1</b> Clustering</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#results-dataframes"><i class="fa fa-check"></i><b>3.3</b> <code>Results</code> dataframes</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-transformation.html"><a href="data-transformation.html#data.csv"><i class="fa fa-check"></i><b>3.3.1</b> <code>data.csv</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="data-transformation.html"><a href="data-transformation.html#cleveland.csv"><i class="fa fa-check"></i><b>3.3.2</b> <code>cleveland.csv</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-transformation.html"><a href="data-transformation.html#mosaic.csv"><i class="fa fa-check"></i><b>3.3.3</b> <code>mosaic.csv</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a><ul>
<li class="chapter" data-level="4.1" data-path="missing-values.html"><a href="missing-values.html#overview-of-missing-values"><i class="fa fa-check"></i><b>4.1</b> Overview of missing values</a></li>
<li class="chapter" data-level="4.2" data-path="missing-values.html"><a href="missing-values.html#visualizing-missing-values-per-row"><i class="fa fa-check"></i><b>4.2</b> Visualizing missing values per row</a></li>
<li class="chapter" data-level="4.3" data-path="missing-values.html"><a href="missing-values.html#frequency-of-patterns"><i class="fa fa-check"></i><b>4.3</b> Frequency of patterns</a></li>
<li class="chapter" data-level="4.4" data-path="missing-values.html"><a href="missing-values.html#interpreting-the-results"><i class="fa fa-check"></i><b>4.4</b> Interpreting the results</a></li>
<li class="chapter" data-level="4.5" data-path="missing-values.html"><a href="missing-values.html#dealing-with-missing-values"><i class="fa fa-check"></i><b>4.5</b> Dealing with missing values</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a><ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#important-terms"><i class="fa fa-check"></i><b>5.1</b> Important terms</a></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#yearly-average-stock-ownership-by-industry"><i class="fa fa-check"></i><b>5.2</b> Yearly average stock ownership by industry</a></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#a-closer-look-at-the-companies"><i class="fa fa-check"></i><b>5.3</b> A closer look at the companies</a></li>
<li class="chapter" data-level="5.4" data-path="results.html"><a href="results.html#ownership-of-the-very_popular-companies"><i class="fa fa-check"></i><b>5.4</b> Ownership of the <code>very_popular</code> companies</a></li>
<li class="chapter" data-level="5.5" data-path="results.html"><a href="results.html#ownership-vs-founding-year"><i class="fa fa-check"></i><b>5.5</b> Ownership vs Founding Year</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploration of the S&amp;P 500 stock ownership in Robinhood between Aug 2018 - Aug 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data transformation</h1>
<p>In this Chapter we will go over the data transformations that we performed in order to combine the different data sources into one.</p>
<p>We performed the data cleaning in four Python notebooks that can be found under the <code>docs/data/preprocessing</code> folder. Here we will provide an overview of what we have done. Please take a look at the notebooks if you need further detail.</p>
<div id="raw-data" class="section level2">
<h2><span class="header-section-number">3.1</span> Raw data</h2>
<p>In this section we will briefly describe how we transformed the raw data</p>
<div id="robintrack-data" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Robintrack data</h3>
<p>As we mentioned in the Data Sources section, we got the number of users holding each company stock per day from Robintrack.</p>
<p>The Robintrack data came in a folder that contained a csv for each company ticker. We read each csv, selected the data for August 2018 - August 2020 and combined them to a dataframe with the following columns: <code>Date</code>, <code>Sybol</code>, <code>users_holding</code>.</p>
<p><em>Code can be found here: <code>data/preprocessing/Robintrack.ipynb</code>.</em></p>
</div>
<div id="sp500-stock-prices-and-volume" class="section level3">
<h3><span class="header-section-number">3.1.2</span> S&amp;P500 stock prices and volume</h3>
<p>Furthermore, we got the daily Closing Price and the total Volume traded between August 2018 - August 2020 for each company by scraping yahoo finance.</p>
<p>More specifically, for each of the S&amp;P500 tickers, we used the python package <code>pandas_datareader</code> to read those values from yahoo finance for the range of dates that we are interested in. We combined those dataframes and resulting in one large dataframe with the following columns: <code>Date</code>, <code>Sybol</code>, <code>Adj.Close</code> and <code>Volume</code>.</p>
<p><em>Code can be found here: <code>data/preprocessing/sp500.ipynb</code>.</em></p>
</div>
<div id="vix-and-mcap" class="section level3">
<h3><span class="header-section-number">3.1.3</span> VIX and Mcap</h3>
<p>We got both Vix and Market cap from Bloomberg Terminal. For Market cap we had to select the tickers we are interested since the raw file contained other companies which are not included in the S&amp;P500 list. The the volatility index was in ready-to-use format since it contained the index value by date.</p>
</div>
<div id="company-characteristics" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Company characteristics</h3>
<p>We got both each companies characteristics from Bloomberg Terminal. Some characteristics that we are particularly interested in are <code>Industry</code> and <code>Year_Founded</code>.</p>
</div>
<div id="combination-of-the-above" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Combination of the above</h3>
<p>We combined everything together in one dataframe. We performed an outer join on <code>Date</code> and <code>Symbol</code> which resulted in our final dataframe with the following columns: <code>Date</code>, <code>Sybol</code>, <code>users_holding</code>,<code>Adj.Close</code>, <code>Volume</code>, <code>Mcap</code>, <code>vix_Adj_close</code>.</p>
<p>We also performed a few sanity checks such as making sure that we are only keeping the trading days between August 2018 - August 2020 and that for each date we have all tickers.</p>
<p><em>Code can be found here: <code>data/preprocessing/combine.ipynb</code></em></p>
</div>
</div>
<div id="further-preprocessing" class="section level2">
<h2><span class="header-section-number">3.2</span> Further preprocessing</h2>
<p>We decided further combine and preprocessing all of the different dataframes in Python.</p>
<div id="clustering" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Clustering</h3>
<div id="clustering-on-users_holding" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> Clustering on <code>users_holding</code></h4>
<p>We measure a stock’s popularity by averaging amount of user’s holding across 2018-2020. Intuitively a company with a high average stock holding will be a popular company among Robintrack’s users and vise verse.</p>
<p>We want to find a way to separate the companies into three popularity groups. One way to do this is to split the data evenly across three sections. However, in our case, a few companies attract users a lot more than others and if we were to follow this approach we would end up with groups that are very uneven in terms of scale.</p>
<p>In order to work around this issue,we assign each company to a popularity level by using K Means clustering(k=3) for the average user’s holding over those 3 years. The three popularity categories are; <code>not_popular</code>(n=473), <code>normal</code>(n=16) and <code>very_popular</code>(n=5). Note that this clustering results to uneven clusters as we would expect. Bellow is a visualization of the clusters produced by python.</p>
<p><img src="docs/data/preprocessing/images/popularity_clusters.png" alt="Popularity Clusters" />
Therefore, we have defined the following popularity ranges:</p>
<ul>
<li><p>cluster <strong>0</strong>: <code>normal</code>(n=16)</p></li>
<li><p>cluster <strong>1</strong>: <code>not_popular</code>(n=473)</p></li>
<li><p>cluster <strong>2</strong>: <code>very_popular</code>(n=5)</p></li>
</ul>
</div>
<div id="clustering-on-year_founded" class="section level4">
<h4><span class="header-section-number">3.2.1.2</span> Clustering on <code>Year_Founded</code>:</h4>
<p>Following a similar line of thinking, we grouped the companies based on their Founded year. We wanted to avoid uneven groups in terms of founding years therefore we again used K Means clustering(k=3).</p>
<p>For each group we recorded the minimum and maximum founding rate and used that as the as group’s label. More specifically the three founding ranges are;<code>1784-1892</code>(n=247),<code>1894-1952</code>(n=400), <code>1954-2019</code>(n=798). Bellow is a visualization of the clusters produced by python.</p>
<div class="figure">
<img src="docs/data/preprocessing/images/foundation_clusters.png" alt="Founding Clusters" />
<p class="caption">Founding Clusters</p>
</div>
<p>Therefore, we have defined the following founded ranges:</p>
<ul>
<li><p>cluster <strong>0</strong>: <code>1894-1952</code>(n=400)</p></li>
<li><p>cluster <strong>1</strong>: <code>1784-1892</code>(n=247)</p></li>
<li><p>cluster <strong>2</strong>: <code>1954-2019</code>(n=798)</p></li>
</ul>
<p><em>Code can be found here: <code>data/preprocessing/Results_preprocessing.ipynb</code>.</em></p>
</div>
</div>
</div>
<div id="results-dataframes" class="section level2">
<h2><span class="header-section-number">3.3</span> <code>Results</code> dataframes</h2>
<p>Description of the final dataframes that we use in <code>Results</code> section</p>
<div id="data.csv" class="section level3">
<h3><span class="header-section-number">3.3.1</span> <code>data.csv</code></h3>
<p>-<code>Date</code>: date</p>
<p>-<code>Symbol</code>: a companies ticker</p>
<p>-<code>users_holding</code>: number of users holding that stock on that date</p>
<p>-<code>Adj.Close</code>: adjusted close price</p>
<p>-<code>Volume</code>: traded volume</p>
<p>-<code>Mcap</code>: market cap</p>
<p>-<code>vix_Adj_close</code>: vix; market index</p>
<p>-<code>Symbol_industry</code>: the industry of the company</p>
<p>-<code>popularity</code>: either of <code>not_popular</code>, <code>normal</code>, <code>very_popular</code></p>
</div>
<div id="cleveland.csv" class="section level3">
<h3><span class="header-section-number">3.3.2</span> <code>cleveland.csv</code></h3>
<p>-<code>Year</code>: year</p>
<p>-<code>Symbol</code>: a companies ticker</p>
<p>-<code>avg_users_holding</code>: average number of users holding that stock on that year</p>
</div>
<div id="mosaic.csv" class="section level3">
<h3><span class="header-section-number">3.3.3</span> <code>mosaic.csv</code></h3>
<p>-<code>Symbol_industry</code>: the industry</p>
<p>-<code>founded_range</code>: the founding range as defined in the clustering section</p>
<p>-<code>popularity</code>: the popularity level as defined in the clustering section</p>
<p>-<code>freq</code>: how many times the above combination of values have appeared in the dataset</p>
<p><em>Files can be found here <code>data/results</code>.</em></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-values.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/KassiePapasotiriou/sp500ownership/edit/main/03-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/KassiePapasotiriou/sp500ownership/blob/main/03-cleaning.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
